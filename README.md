# مدیریت آی پی های تمیز کلودفلر با ورکر
این اموزش به درد کانفیگ های شخصی میخوره که هربار به صورت دستی آی پی تمیز برای کانفیگ ها ست نکنین و کاربرها بتونن خودشون وایت لیست درست کنن وساب بگیرین.
( فعلا فقط کانفیگ های vless ساپورت میشه )
با استفاده از این ابزار میتونین اسکریپت آی پی تمیز رو به هرکاربر خودتون بدین تا با توجه به اپراتوری که داره ای پی تمیز رو پیدا کنه و در ورکر شما ذخیره کنه با با ساب بتونه کانفیگ رو بر اساس همون ای پی ها دریافت کنه یا از آی پی های تمیز که بقیه کاربرها پیدا کردن استفاده کنه 
# نیازمندی   
این اسکریپت از ورکر کلود فلر و KV کلود فلر برای ذخیره لیست ای پی ها استفاده میکنه و نیازی به تهیه سرور یا دامین نیست

# نحوه استفاده 
ابتدا از طریق پنل کلودفر یک ورکر ایجاد کنید

<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230433211-359d886f-4fd5-46f3-88c4-ef959e0569c6.png">
</p>

طبق تصویر مشخص شده اسم ورکر رو انتخاب کنید و ذخیره کنید
<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230447451-f9b47f77-4d51-4453-af9c-daff48e08654.png">
</p>

بعد از ایجاد ورکر قبل از کپی کردن اسکریپت ورکر به بخش KV برید تا یک مخزن اطلاعات در کلود فلر ایجاد کنیم. 
اطلاعات بیشتر در مورد KV رو میتونید [اینجا](https://developers.cloudflare.com/workers/learning/how-kv-works/) بخونید

<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230448749-206816d5-63b7-4408-be83-2782b9853a18.png">
</p>

در صفحه جدید روی گزینه ایجاد کلیک کنید و یک KV به نام SUB بسازید.
این اسم SUB در سورس اسکریپت استفاده شده اگر اسم دیگه ای انتخاب می کنید باید در سورس هم این رو تغییر بدین . 

<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230449003-330734c4-0458-499c-a47e-5e8750bb34c0.png">
</p>

برگردید به صفحه ورکر ها و ورکری که ساختید رو روش کلیک کنید تا وارد جزییاتش بشید و طبق تصویر وارد بخش تنظیمات ورکر بشید : 
<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230449250-8d06784d-f64b-498d-8e44-7282d9034c16.png">
</p>

در همون بخش صفحه رو اسکرول کنید و بخش KV Binding رو اون KV که ساخته بودیم رو برای استفاده در ورکر تنظیم میکنیم
( اسم انتخابی باید مثل سورس کد باشه پس اگر سورس کد رو تغییر نمیدین مثل تصویر پر کنید )


<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230449641-d3b2c68b-bf6a-4de1-83df-3f344638c31b.png">
</p>

در همین صفحه بالای صفحه گزینه edit رو بزنید تا سورس ورکر رو تغییر بدیم ( وارد صفحه زیر میشید ) 


<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230449990-8d5dd8bb-ddce-42ed-b1e4-e76608faf6f1.png">
</p>

تنظیمات ابتدایی ورکر در بخش مشخص شده رو بر اساس توضصیحات کامنت تنظیم کنید و گزینه Deploy رو بزنید و تمام

با ارسال درخواست GET با PATH مشخص شده SUB میتونید لیست ساب رو دریافت کنید و با PATH مشخص شده whitelist میتونید آی پی های تمیز هرکاربر رو ذخیره کنید . 

با استفاده از سورس Scanner با پاس دادن user میتونید مشخص کنید بعد از ارسال ای پی ها برای کاربر مشخص شده ثبت شود یا کل کاربران . 
# ثبت وایت لیست 
https://test.workers.dev/sub?user=USERNAME&operator=HAMRAHE_AVAL&whitelist=172.26.2.3,172.20.2.5 

user = نام کاربری اگر وارد شود لیست فقط برای کاربر مشخص شده ذخیره میشه و در ساب همون کاربر برمیگرده

operator = وایت لیست برای چه اپراتوری ذخیره بشه 

whitelist = لیست ای پی های تمیز جداشده با ,

# دریافت ساب
https://test.workers.dev/sub?user=USERNAME&operators=HAMRAHE_AVAL&useOwnlist=false

user = اگر مشخص شود لیست ای پی های تمیز کاربر شخصی خود را دریافت می کند

operators = اگر وارد شود لیست ساب بر اساس اپراتورهای درخواستی تولید می شود

useOwnList =  اگر true ارسال شود فقط شامل ای پی های تمیزی که خود کاربر قبلا با اسکنر ارسال کرده میشه در غیر این صورت علاوه بر ای پی ها شخصی ای پی ها عمومی که بقیه کاربران هم ارسال کردن تمیز هست در ساب تولید میشه


# ارسال آی پی های تمیز به ورکر 
بعد از اجرای فایل scanner.html بر اساس نیاز تیک گزینه فقط برای خودم ( حتما پارامتر user در url اضافه شود در این صورت ) و نوع اپراتور ور انتخاب کنید پس از اسکن و نمایش نتایج گزینه ارسال به سرور رو بزنید . 
آدرس سرور خودتون رو در فایل scanner.html تغییر بدین . 


<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230453322-96271e6a-e6fa-40a8-866e-d68fae1f613e.png">
</p>

اگر پارامتر user مشخص نشده باشه یا تیک فقط برای خودم رو نزنید لیستش به صورت کلی ذخیره میشه و همه کاربران میتونن دریافتش کنن. 

<p align="center">
    <img src="https://user-images.githubusercontent.com/55354691/230453401-134062f3-d987-4ba2-b540-8f7f5a9c0c33.png">
</p>

می تونید اسکنر رو در یک هاست رایگان مثل پارس پک اپلود کنین و بدین کاربرانتون هرکس برای اپراتور خودش وایت لیست ایجاد کنه . 
تمام . 

. 
